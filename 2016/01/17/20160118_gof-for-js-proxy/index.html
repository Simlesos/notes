<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="telephone=no" name="format-detection"/><meta name="description" content="和志强,前端,.NET,兴趣使然的键盘操纵者,不错的YoungBoy,螳臂当车的歹徒"/><title>js设计模式之代理模式 | 莫声谷</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"/><link rel="stylesheet" type="text/css" href="/css/pure-min.css"/><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"/><link rel="stylesheet" type="text/css" href="/css/style.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">js设计模式之代理模式</h1><a id="logo" href="/">莫声谷</a><p class="description">突然想到你，笑了笑自己</p></div><div id="nav-menu"><a href="/" class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/about/"><i class="icon-about"> 关于</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">js设计模式之代理模式</h1><div class="post-meta">2016-01-17 | <span class="categories">分类于<a href="/categories/FE/"> FE</a></span></div><span data-disqus-identifier="2016/01/17/20160118_gof-for-js-proxy/" class="disqus-comment-count"></span><div class="post-content"><p>乱哄哄，你方唱罢我登场，反认他乡是故乡；甚荒唐，到头来都是为他人作嫁衣裳。</p>
<h2 id="u4EE3_u7406_u6A21_u5F0F"><a href="#u4EE3_u7406_u6A21_u5F0F" class="headerlink" title="代理模式"></a>代理模式</h2><blockquote>
<p>为对象提供一种代理以控制这个对象的访问.</p>
</blockquote>
<p>公司BOSS需要定期检查项目进度,但是他并不会直接问你,而是让你的小组长去问你,小组长询问进度,问完后,将报告给交给BOSS.你的小组长在这个过程中就是代理.换句话说,在请求中当本体对象不方便直接回应的时候,提供一个代理对象来控制对这个对象的访问,代理对象对请求作出一些处理后,再把请求转交给本体对象.这就是代理模式的意义.</p>
<h2 id="u8001_u677F_u7EC4_u957F_u548C_u4F60"><a href="#u8001_u677F_u7EC4_u957F_u548C_u4F60" class="headerlink" title="老板组长和你"></a>老板组长和你</h2><p>我们试着来用代码来实现以下上面的例子:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Report = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//访问者</span></span><br><span class="line"><span class="keyword">var</span> boss = &#123;</span><br><span class="line">    checkProject: <span class="function"><span class="keyword">function</span> (<span class="params">target</span>) </span>&#123;</span><br><span class="line">        target.submitReport();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//代理对象</span></span><br><span class="line"><span class="keyword">var</span> leader = &#123;</span><br><span class="line">    submitReport: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        laoZhang.submitReport();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//本体对象</span></span><br><span class="line"><span class="keyword">var</span> laoZhang = &#123;</span><br><span class="line">    submitReport: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> report = <span class="keyword">new</span> Report(<span class="string">'xxx项目报告'</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'提交报告:'</span> + report.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">boss.checkProject(leader); <span class="comment">//=&gt; 提交报告: <span class="label">xxx项目报告</span></span></span><br></pre></td></tr></table></figure></p>
<p>这里我们就完成了一个简单的代理模式,但是这里 leader 什么都没做,只是简单的把老张的报告交上去.现在我们来考虑一种情况,当boss 问老张要报告的时候,老张此时正在为解决一个BUG搞的焦头烂额,此时再让老张交个报告,老张肯定会爆炸的,报告做的不好,老张说不定就会被开除,这时候加入一个代理对象 leader 来随时监听老张是否空闲,就可以避免在老张忙碌的时候去打扰他,我们修改上面的例子:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Report = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> boss = &#123;</span><br><span class="line">    checkProject: <span class="function"><span class="keyword">function</span> (<span class="params">target</span>) </span>&#123;</span><br><span class="line">        target.submitReport();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> leader = &#123;</span><br><span class="line">    submitReport: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        laoZhang.listenState(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            laoZhang.submitReport();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> laoZhang = &#123;</span><br><span class="line">    submitReport: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> report = <span class="keyword">new</span> Report(<span class="string">'xxx项目报告'</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'提交报告:'</span> + report.name);</span><br><span class="line">    &#125;,</span><br><span class="line">    listenState: <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>)</span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            fn();</span><br><span class="line">        &#125;,<span class="number">5000</span>); <span class="comment">//假设5秒后老张有空</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">boss.checkProject(leader);  <span class="comment">//=&gt; 5s 后输出 <span class="label">xxx项目报告</span></span></span><br></pre></td></tr></table></figure>
<h2 id="u4EE3_u7406_u6A21_u5F0F_u5206_u7C7B"><a href="#u4EE3_u7406_u6A21_u5F0F_u5206_u7C7B" class="headerlink" title="代理模式分类"></a>代理模式分类</h2><p>一般来说代理模式分为<code>远程代理</code>,<code>虚拟代理</code>,<code>安全代理</code></p>
<ul>
<li><code>远程代理</code>: 远程代理就是为一个对象在不同的地址空间提供据局部代表,这样可以隐藏一个对象存在于不同地址空间的事实.举个栗子,C#的 WebService 添加时,会在项目中生成一个 WebReference 文件夹,其实它就是代理.</li>
<li><code>虚拟代理</code>: 虚拟代理是根据需要创建开销很大的对象,通过它来存放实例化需要很长时间的真实对象.举个栗子,我们经常会让一些比较大的图片在加载完成前,先用一张默认的图片放上去替代,等图片资源加载完了,再替换回来,这里我们的默认图片就是虚拟代理,虚拟代理中存储了真实的图片大小和路径</li>
<li><code>安全代理</code>:安全代理是用来控制真实对象的访问权限.一般用于对象应该有不同的访问权限的时候.</li>
</ul>
<h2 id="u865A_u62DF_u4EE3_u7406_u5E94_u7528"><a href="#u865A_u62DF_u4EE3_u7406_u5E94_u7528" class="headerlink" title="虚拟代理应用"></a>虚拟代理应用</h2><p>代理模式可以做很多事情,在js中我们比较常用的石 <code>虚拟代理</code>.我们用代码来实现一下上面提到的默认图片加载的代码:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> image = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> imgNode = <span class="built_in">document</span>.createElement(<span class="string">'image'</span>);</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(imgNode);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        setSrc: <span class="function"><span class="keyword">function</span>(<span class="params">src</span>)</span>&#123;</span><br><span class="line">            imgNode.src = src;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> proxyImage = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> proxyImgNode = <span class="keyword">new</span> Image;</span><br><span class="line">    proxyImgNode.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        image.setSrc(<span class="keyword">this</span>.src);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        setSrc: <span class="function"><span class="keyword">function</span>(<span class="params">src</span>)</span>&#123;</span><br><span class="line">            image.setSrc(<span class="string">'默认图片地址'</span>)</span><br><span class="line">            proxyImgNode.src = src;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line">proxyImage.setSrc(<span class="string">'真实图片地址'</span>);</span><br></pre></td></tr></table></figure></p>
<p>这里我们通过 proxyImage 代理对象来访问 image,并在代理对象中加入了一些额外的操作,将在真正的图片加载完成前,先给 image 加载一个默认的图片.</p>
<h2 id="u8FD9_u4E48_u505A_u6709_u4F55_u610F_u4E49"><a href="#u8FD9_u4E48_u505A_u6709_u4F55_u610F_u4E49" class="headerlink" title="这么做有何意义"></a>这么做有何意义</h2><p>确实,上面的代码即使不用代理模式也都能实现. 但是这并不符合我们的程序设计思想<code>单一职责原则</code>和<code>封闭开放原则</code>,比如说上面图片的例子中,如果我们不需要默认图片加载了,那我们直接将代理对象切换成正常对象就可以了,而不适用代理模式的话,你就需要直接修改代码去删掉一些内容了.可以说,所有的设计模式都是为了保证我们的设计原则下才被写出来的,使用的时候不可本末倒置.</p>
<h2 id="u5176_u4ED6_u7684_u4EE3_u7406_u6A21_u5F0F"><a href="#u5176_u4ED6_u7684_u4EE3_u7406_u6A21_u5F0F" class="headerlink" title="其他的代理模式"></a>其他的代理模式</h2><p><code>javascript语言精粹</code>第 43 页讲了一种记忆函数,其实就是一种缓存代理.我们来用代理模式实现以下 Fibonacci 数计算的函数:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fibonacci = <span class="function"><span class="keyword">function</span> (<span class="params">n</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n &lt; <span class="number">2</span> ? n : fibonacci(n - <span class="number">1</span>) + fibonacci(n - <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> memoizer = <span class="function"><span class="keyword">function</span> (<span class="params">memo, formula</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> memo[n] ? memo[n] : memo[n] = formula.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> proxyFibonacci = memoizer([<span class="number">0</span>,<span class="number">1</span>],fibonacci);</span><br><span class="line">proxyFibonacci(<span class="number">10</span>); <span class="comment">//=&gt;55</span></span><br></pre></td></tr></table></figure></p>
<h2 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="总结"></a>总结</h2><p>代理模式其实就是在访问对象时引入一定程度的间接性,因为这种间接性,可以附加多种用途!代理模式有很多类型,在 js 开发中,常见的就是虚拟代理和缓存代理,我在写代码的时候不必直接去猜测该不该用代理模式,而是当不放访问某个对象时,再上代理模式即可.</p>
</div><div class="tags"><a href="/tags/GOF/">GOF</a><a href="/tags/javascript/">javascript</a><a href="/tags/前端/">前端</a><a href="/tags/面向对象/">面向对象</a></div><div class="post-nav"><a href="/2016/01/22/20160122_gof-for-js-strategy/" class="pre"><i class="icon-previous">js设计模式之策略模式</i></a><a href="/2016/01/17/20160117_gof_for_js_single/" class="next">js设计模式之单例模式<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'imhzq';
var disqus_identifier = '2016/01/17/20160118_gof-for-js-proxy/';
var disqus_title = 'js设计模式之代理模式';
var disqus_url = 'http://imhzq.com/2016/01/17/20160118_gof-for-js-proxy/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//imhzq.disqus.com/count.js" async="async"></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="sitesearch" value="http://imhzq.com"/></form></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Emotion/">Emotion</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/FE/">FE</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Freedom/">Freedom</a></li></ul></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/ES6/" style="font-size: 15px;">ES6</a> <a href="/tags/GOF/" style="font-size: 15px;">GOF</a> <a href="/tags/面向对象/" style="font-size: 15px;">面向对象</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a> <a href="/tags/模块化/" style="font-size: 15px;">模块化</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/Css/" style="font-size: 15px;">Css</a> <a href="/tags/CSS3动画/" style="font-size: 15px;">CSS3动画</a> <a href="/tags/生活/" style="font-size: 15px;">生活</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/Sass/" style="font-size: 15px;">Sass</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/01/25/20160125_gof-for-js-pubsub/">js设计模式之观察者模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/23/20160123-gof-for-js-each/">js设计模式之迭代器模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/22/20160122_gof-for-js-strategy/">js设计模式之策略模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/17/20160118_gof-for-js-proxy/">js设计模式之代理模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/17/20160117_gof_for_js_single/">js设计模式之单例模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/15/20160115_js_module/">JS模块化历程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/13/20160113_js_cheat_scope/">修改js词法作用域的几种方式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/12/20160112_js_es6_let/">ES6之let</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/10/20160110_js_variable_up/">JS中的提升</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/06/20160106_css_flex2/">flex简明教程(二)</a></li></ul></div><div class="widget"><div class="widget-title">最近评论</div><script type="text/javascript" src="//imhzq.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"></div></div></div></div><div id="footer">© <a href="/" rel="nofollow">莫声谷.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-62344719-1','auto');ga('send','pageview');</script></div></body></html>